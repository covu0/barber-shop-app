<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barber Shop Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* AI Chat Styles */
        .chat-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 70%;
        }
        
        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .message.bot {
            background: #e0e0e0;
            color: #333;
        }
        
        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #ddd;
        }
        
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .chat-input button {
            margin-left: 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button.submit {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button.submit:hover {
            background: #5a67d8;
        }
        
        /* Dashboard Styles */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Appointments List */
        .appointments-list {
            margin-top: 20px;
        }
        
        .appointment-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .appointment-info {
            flex: 1;
        }
        
        .appointment-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-cancel {
            background: #ef4444;
            color: white;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert.success {
            background: #10b981;
            color: white;
        }
        
        .alert.error {
            background: #ef4444;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ’ˆ Barber Shop Booking System</h1>
            <p>AI-Powered Scheduling for Your Barber Shop</p>
            
            <div class="tabs">
                <button class="tab active" onclick="showSection('chat')">AI Assistant</button>
                <button class="tab" onclick="showSection('dashboard')">Dashboard</button>
                <button class="tab" onclick="showSection('setup')">Shop Setup</button>
                <button class="tab" onclick="showSection('employees')">Employees</button>
                <button class="tab" onclick="showSection('booking')">Manual Booking</button>
            </div>
        </header>
        
        <div class="content">
            <!-- AI Chat Section -->
            <div id="chat" class="section active">
                <h2>Chat with AI Assistant</h2>
                <p>Try saying: "Book an appointment for tomorrow at 2pm" or "Check availability with Mike"</p>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot">
                            Hello! I'm your barber shop booking assistant. How can I help you today?
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Type your message..." 
                               onkeypress="if(event.key=='Enter') sendMessage()">
                        <button onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <h2>Dashboard</h2>
                <div id="dashboardContent">
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="todayAppointments">0</h3>
                            <p>Today's Appointments</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="weekAppointments">0</h3>
                            <p>This Week</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="activeEmployees">0</h3>
                            <p>Active Employees</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="totalCustomers">0</h3>
                            <p>Total Customers</p>
                        </div>
                    </div>
                    
                    <h3>Today's Appointments</h3>
                    <div class="appointments-list" id="appointmentsList">
                        <!-- Appointments will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- Shop Setup Section -->
            <div id="setup" class="section">
                <h2>Shop Setup</h2>
                <form id="shopForm">
                    <div class="form-group">
                        <label>Shop Name</label>
                        <input type="text" name="name" required value="Premium Cuts Barbershop">
                    </div>
                    <div class="form-group">
                        <label>Owner Name</label>
                        <input type="text" name="owner_name" required value="John Doe">
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <input type="text" name="address" value="123 Main St">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" name="phone" value="555-0100">
                    </div>
                    <div class="form-group">
                        <label>Opening Time</label>
                        <input type="time" name="opening_time" value="09:00">
                    </div>
                    <div class="form-group">
                        <label>Closing Time</label>
                        <input type="time" name="closing_time" value="20:00">
                    </div>
                    <button type="submit" class="submit">Create Shop</button>
                </form>
            </div>
            
            <!-- Employees Section -->
            <div id="employees" class="section">
                <h2>Manage Employees</h2>
                <form id="employeeForm">
                    <div class="form-group">
                        <label>Employee Name</label>
                        <input type="text" name="name" required placeholder="e.g., Mike Johnson">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" name="phone" required placeholder="555-0101">
                    </div>
                    <div class="form-group">
                        <label>Specialization</label>
                        <input type="text" name="specialization" placeholder="e.g., Classic cuts, Beard styling">
                    </div>
                    <div class="form-group">
                        <label>Working Days</label>
                        <input type="text" name="working_days" value="Mon,Tue,Wed,Thu,Fri,Sat">
                    </div>
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" name="start_time" value="09:00">
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" name="end_time" value="18:00">
                    </div>
                    <button type="submit" class="submit">Add Employee</button>
                </form>
                
                <h3 style="margin-top: 30px;">Current Employees</h3>
                <div id="employeesList"></div>
            </div>
            
            <!-- Manual Booking Section -->
            <div id="booking" class="section">
                <h2>Manual Booking</h2>
                <form id="bookingForm">
                    <div class="form-group">
                        <label>Select Employee</label>
                        <select name="employee_id" id="employeeSelect" required>
                            <option value="">-- Select Employee --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Customer Name</label>
                        <input type="text" name="customer_name" required>
                    </div>
                    <div class="form-group">
                        <label>Customer Phone</label>
                        <input type="tel" name="customer_phone" required>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="appointment_date" required>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" name="start_time" required>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea name="notes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="submit">Book Appointment</button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8000';
        let currentShopId = 1;  // Default shop ID
        
        // Show/Hide sections
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load data for specific sections
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'employees') {
                loadEmployees();
            }
        }
        
        // Chat functionality
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            try {
                const response = await fetch(`${API_URL}/api/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        customer_phone: '555-1234'  // You can make this dynamic
                    })
                });
                
                const data = await response.json();
                addMessage(data.message, 'bot');
            } catch (error) {
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
            }
        }
        
        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Shop setup
        document.getElementById('shopForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_URL}/api/shops`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentShopId = result.id;
                    showAlert('Shop created successfully!', 'success');
                    e.target.reset();
                }
            } catch (error) {
                showAlert('Error creating shop', 'error');
            }
        });
        
        // Employee management
        document.getElementById('employeeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_URL}/api/shops/${currentShopId}/employees`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showAlert('Employee added successfully!', 'success');
                    e.target.reset();
                    loadEmployees();
                }
            } catch (error) {
                showAlert('Error adding employee', 'error');
            }
        });
        
        // Load employees
        async function loadEmployees() {
            try {
                const response = await fetch(`${API_URL}/api/shops/${currentShopId}/employees`);
                const employees = await response.json();
                
                const listDiv = document.getElementById('employeesList');
                const selectElement = document.getElementById('employeeSelect');
                
                listDiv.innerHTML = '';
                selectElement.innerHTML = '<option value="">-- Select Employee --</option>';
                
                employees.forEach(emp => {
                    // Add to list
                    const empDiv = document.createElement('div');
                    empDiv.className = 'appointment-item';
                    empDiv.innerHTML = `
                        <div class="appointment-info">
                            <strong>${emp.name}</strong><br>
                            Phone: ${emp.phone}<br>
                            Hours: ${emp.start_time} - ${emp.end_time}
                        </div>
                    `;
                    listDiv.appendChild(empDiv);
                    
                    // Add to select
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = emp.name;
                    selectElement.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading employees:', error);
            }
        }
        
        // Manual booking
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch(`${API_URL}/api/bookings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    showAlert('Appointment booked successfully!', 'success');
                    e.target.reset();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || 'Booking failed', 'error');
                }
            } catch (error) {
                showAlert('Error creating booking', 'error');
            }
        });
        
        // Load dashboard
        async function loadDashboard() {
            try {
                const response = await fetch(`${API_URL}/api/dashboard/${currentShopId}`);
                const data = await response.json();
                
                document.getElementById('todayAppointments').textContent = 
                    data.stats.todays_appointments;
                document.getElementById('weekAppointments').textContent = 
                    data.stats.week_appointments;
                document.getElementById('activeEmployees').textContent = 
                    data.stats.active_employees;
                document.getElementById('totalCustomers').textContent = 
                    data.stats.total_customers;
                
                // Load today's appointments
                loadTodayAppointments();
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        // Load today's appointments
        async function loadTodayAppointments() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(
                    `${API_URL}/api/shops/${currentShopId}/appointments?date=${today}`
                );
                const appointments = await response.json();
                
                const listDiv = document.getElementById('appointmentsList');
                listDiv.innerHTML = '';
                
                if (appointments.length === 0) {
                    listDiv.innerHTML = '<p>No appointments scheduled for today.</p>';
                    return;
                }
                
                appointments.forEach(apt => {
                    const aptDiv = document.createElement('div');
                    aptDiv.className = 'appointment-item';
                    aptDiv.innerHTML = `
                        <div class="appointment-info">
                            <strong>${apt.start_time} - ${apt.end_time}</strong><br>
                            Customer: ${apt.customer_name}<br>
                            Barber: ${apt.employee_name}<br>
                            Service: ${apt.service}
                        </div>
                        <div class="appointment-actions">
                            <button class="btn-small btn-cancel" 
                                    onclick="cancelAppointment(${apt.id})">
                                Cancel
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(aptDiv);
                });
            } catch (error) {
                console.error('Error loading appointments:', error);
            }
        }
        
        // Cancel appointment
        async function cancelAppointment(appointmentId) {
            if (!confirm('Are you sure you want to cancel this appointment?')) return;
            
            try {
                const response = await fetch(`${API_URL}/api/bookings/${appointmentId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showAlert('Appointment cancelled', 'success');
                    loadTodayAppointments();
                }
            } catch (error) {
                showAlert('Error cancelling appointment', 'error');
            }
        }
        
        // Show alert
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            
            const content = document.querySelector('.content');
            content.insertBefore(alert, content.firstChild);
            
            setTimeout(() => alert.remove(), 3000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set today's date as default
            const dateInputs = document.querySelectorAll('input[type="date"]');
            const today = new Date().toISOString().split('T')[0];
            dateInputs.forEach(input => input.value = today);
        });
    </script>
</body>
</html>